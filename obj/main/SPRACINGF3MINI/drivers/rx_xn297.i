# 1 "./src/main/drivers/rx_xn297.c"
# 1 "<built-in>"
# 1 "<command-line>"
# 1 "./src/main/drivers/rx_xn297.c"
# 21 "./src/main/drivers/rx_xn297.c"
# 1 "/home/nirigan3/icarus/cleanflight/tools/gcc-arm-none-eabi-6-2017-q2-update/lib/gcc/arm-none-eabi/6.3.1/include/stdbool.h" 1 3 4
# 22 "./src/main/drivers/rx_xn297.c" 2
# 1 "/home/nirigan3/icarus/cleanflight/tools/gcc-arm-none-eabi-6-2017-q2-update/lib/gcc/arm-none-eabi/6.3.1/include/stdint.h" 1 3 4
# 9 "/home/nirigan3/icarus/cleanflight/tools/gcc-arm-none-eabi-6-2017-q2-update/lib/gcc/arm-none-eabi/6.3.1/include/stdint.h" 3 4
# 1 "/home/nirigan3/icarus/cleanflight/tools/gcc-arm-none-eabi-6-2017-q2-update/arm-none-eabi/include/stdint.h" 1 3 4
# 12 "/home/nirigan3/icarus/cleanflight/tools/gcc-arm-none-eabi-6-2017-q2-update/arm-none-eabi/include/stdint.h" 3 4
# 1 "/home/nirigan3/icarus/cleanflight/tools/gcc-arm-none-eabi-6-2017-q2-update/arm-none-eabi/include/machine/_default_types.h" 1 3 4







# 1 "/home/nirigan3/icarus/cleanflight/tools/gcc-arm-none-eabi-6-2017-q2-update/arm-none-eabi/include/sys/features.h" 1 3 4
# 28 "/home/nirigan3/icarus/cleanflight/tools/gcc-arm-none-eabi-6-2017-q2-update/arm-none-eabi/include/sys/features.h" 3 4
# 1 "/home/nirigan3/icarus/cleanflight/tools/gcc-arm-none-eabi-6-2017-q2-update/arm-none-eabi/include/_newlib_version.h" 1 3 4
# 29 "/home/nirigan3/icarus/cleanflight/tools/gcc-arm-none-eabi-6-2017-q2-update/arm-none-eabi/include/sys/features.h" 2 3 4
# 9 "/home/nirigan3/icarus/cleanflight/tools/gcc-arm-none-eabi-6-2017-q2-update/arm-none-eabi/include/machine/_default_types.h" 2 3 4
# 41 "/home/nirigan3/icarus/cleanflight/tools/gcc-arm-none-eabi-6-2017-q2-update/arm-none-eabi/include/machine/_default_types.h" 3 4

# 41 "/home/nirigan3/icarus/cleanflight/tools/gcc-arm-none-eabi-6-2017-q2-update/arm-none-eabi/include/machine/_default_types.h" 3 4
typedef signed char __int8_t;

typedef unsigned char __uint8_t;
# 55 "/home/nirigan3/icarus/cleanflight/tools/gcc-arm-none-eabi-6-2017-q2-update/arm-none-eabi/include/machine/_default_types.h" 3 4
typedef short int __int16_t;

typedef short unsigned int __uint16_t;
# 77 "/home/nirigan3/icarus/cleanflight/tools/gcc-arm-none-eabi-6-2017-q2-update/arm-none-eabi/include/machine/_default_types.h" 3 4
typedef long int __int32_t;

typedef long unsigned int __uint32_t;
# 103 "/home/nirigan3/icarus/cleanflight/tools/gcc-arm-none-eabi-6-2017-q2-update/arm-none-eabi/include/machine/_default_types.h" 3 4
typedef long long int __int64_t;

typedef long long unsigned int __uint64_t;
# 134 "/home/nirigan3/icarus/cleanflight/tools/gcc-arm-none-eabi-6-2017-q2-update/arm-none-eabi/include/machine/_default_types.h" 3 4
typedef signed char __int_least8_t;

typedef unsigned char __uint_least8_t;
# 160 "/home/nirigan3/icarus/cleanflight/tools/gcc-arm-none-eabi-6-2017-q2-update/arm-none-eabi/include/machine/_default_types.h" 3 4
typedef short int __int_least16_t;

typedef short unsigned int __uint_least16_t;
# 182 "/home/nirigan3/icarus/cleanflight/tools/gcc-arm-none-eabi-6-2017-q2-update/arm-none-eabi/include/machine/_default_types.h" 3 4
typedef long int __int_least32_t;

typedef long unsigned int __uint_least32_t;
# 200 "/home/nirigan3/icarus/cleanflight/tools/gcc-arm-none-eabi-6-2017-q2-update/arm-none-eabi/include/machine/_default_types.h" 3 4
typedef long long int __int_least64_t;

typedef long long unsigned int __uint_least64_t;
# 214 "/home/nirigan3/icarus/cleanflight/tools/gcc-arm-none-eabi-6-2017-q2-update/arm-none-eabi/include/machine/_default_types.h" 3 4
typedef long long int __intmax_t;







typedef long long unsigned int __uintmax_t;







typedef int __intptr_t;

typedef unsigned int __uintptr_t;
# 13 "/home/nirigan3/icarus/cleanflight/tools/gcc-arm-none-eabi-6-2017-q2-update/arm-none-eabi/include/stdint.h" 2 3 4
# 1 "/home/nirigan3/icarus/cleanflight/tools/gcc-arm-none-eabi-6-2017-q2-update/arm-none-eabi/include/sys/_intsup.h" 1 3 4
# 35 "/home/nirigan3/icarus/cleanflight/tools/gcc-arm-none-eabi-6-2017-q2-update/arm-none-eabi/include/sys/_intsup.h" 3 4
       
       
       
       
       
       
       
# 187 "/home/nirigan3/icarus/cleanflight/tools/gcc-arm-none-eabi-6-2017-q2-update/arm-none-eabi/include/sys/_intsup.h" 3 4
       
       
       
       
       
       
       
# 14 "/home/nirigan3/icarus/cleanflight/tools/gcc-arm-none-eabi-6-2017-q2-update/arm-none-eabi/include/stdint.h" 2 3 4
# 1 "/home/nirigan3/icarus/cleanflight/tools/gcc-arm-none-eabi-6-2017-q2-update/arm-none-eabi/include/sys/_stdint.h" 1 3 4
# 20 "/home/nirigan3/icarus/cleanflight/tools/gcc-arm-none-eabi-6-2017-q2-update/arm-none-eabi/include/sys/_stdint.h" 3 4
typedef __int8_t int8_t ;



typedef __uint8_t uint8_t ;







typedef __int16_t int16_t ;



typedef __uint16_t uint16_t ;







typedef __int32_t int32_t ;



typedef __uint32_t uint32_t ;







typedef __int64_t int64_t ;



typedef __uint64_t uint64_t ;






typedef __intmax_t intmax_t;




typedef __uintmax_t uintmax_t;




typedef __intptr_t intptr_t;




typedef __uintptr_t uintptr_t;
# 15 "/home/nirigan3/icarus/cleanflight/tools/gcc-arm-none-eabi-6-2017-q2-update/arm-none-eabi/include/stdint.h" 2 3 4






typedef __int_least8_t int_least8_t;
typedef __uint_least8_t uint_least8_t;




typedef __int_least16_t int_least16_t;
typedef __uint_least16_t uint_least16_t;




typedef __int_least32_t int_least32_t;
typedef __uint_least32_t uint_least32_t;




typedef __int_least64_t int_least64_t;
typedef __uint_least64_t uint_least64_t;
# 51 "/home/nirigan3/icarus/cleanflight/tools/gcc-arm-none-eabi-6-2017-q2-update/arm-none-eabi/include/stdint.h" 3 4
  typedef int int_fast8_t;
  typedef unsigned int uint_fast8_t;
# 61 "/home/nirigan3/icarus/cleanflight/tools/gcc-arm-none-eabi-6-2017-q2-update/arm-none-eabi/include/stdint.h" 3 4
  typedef int int_fast16_t;
  typedef unsigned int uint_fast16_t;
# 71 "/home/nirigan3/icarus/cleanflight/tools/gcc-arm-none-eabi-6-2017-q2-update/arm-none-eabi/include/stdint.h" 3 4
  typedef int int_fast32_t;
  typedef unsigned int uint_fast32_t;
# 81 "/home/nirigan3/icarus/cleanflight/tools/gcc-arm-none-eabi-6-2017-q2-update/arm-none-eabi/include/stdint.h" 3 4
  typedef long long int int_fast64_t;
  typedef long long unsigned int uint_fast64_t;
# 10 "/home/nirigan3/icarus/cleanflight/tools/gcc-arm-none-eabi-6-2017-q2-update/lib/gcc/arm-none-eabi/6.3.1/include/stdint.h" 2 3 4
# 23 "./src/main/drivers/rx_xn297.c" 2

# 1 "./src/main/drivers/rx_spi.h" 1
# 17 "./src/main/drivers/rx_spi.h"
       




# 21 "./src/main/drivers/rx_spi.h"
typedef enum {
    RX_SPI_SOFTSPI,
    RX_SPI_HARDSPI
} rx_spi_type_e;



void rxSpiDeviceInit(rx_spi_type_e spiType);
uint8_t rxSpiTransferByte(uint8_t data);
uint8_t rxSpiWriteByte(uint8_t data);
uint8_t rxSpiWriteCommand(uint8_t command, uint8_t data);
uint8_t rxSpiWriteCommandMulti(uint8_t command, const uint8_t *data, uint8_t length);
uint8_t rxSpiReadCommand(uint8_t command, uint8_t commandData);
uint8_t rxSpiReadCommandMulti(uint8_t command, uint8_t commandData, uint8_t *retData, uint8_t length);
# 25 "./src/main/drivers/rx_xn297.c" 2
# 1 "./src/main/drivers/rx_nrf24l01.h" 1
# 21 "./src/main/drivers/rx_nrf24l01.h"
       
# 33 "./src/main/drivers/rx_nrf24l01.h"
enum {
    NRF24L01_00_CONFIG = 0x00,
    NRF24L01_01_EN_AA = 0x01,
    NRF24L01_02_EN_RXADDR = 0x02,
    NRF24L01_03_SETUP_AW = 0x03,
    NRF24L01_04_SETUP_RETR = 0x04,
    NRF24L01_05_RF_CH = 0x05,
    NRF24L01_06_RF_SETUP = 0x06,
    NRF24L01_07_STATUS = 0x07,
    NRF24L01_08_OBSERVE_TX = 0x08,
    NRF24L01_09_RPD = 0x09,
    NRF24L01_0A_RX_ADDR_P0 = 0x0A,
    NRF24L01_0B_RX_ADDR_P1 = 0x0B,
    NRF24L01_0C_RX_ADDR_P2 = 0x0C,
    NRF24L01_0D_RX_ADDR_P3 = 0x0D,
    NRF24L01_0E_RX_ADDR_P4 = 0x0E,
    NRF24L01_0F_RX_ADDR_P5 = 0x0F,
    NRF24L01_10_TX_ADDR = 0x10,
    NRF24L01_11_RX_PW_P0 = 0x11,
    NRF24L01_12_RX_PW_P1 = 0x12,
    NRF24L01_13_RX_PW_P2 = 0x13,
    NRF24L01_14_RX_PW_P3 = 0x14,
    NRF24L01_15_RX_PW_P4 = 0x15,
    NRF24L01_16_RX_PW_P5 = 0x16,
    NRF24L01_17_FIFO_STATUS = 0x17,
    NRF24L01_1C_DYNPD = 0x1C,
    NRF24L01_1D_FEATURE = 0x1D
};


enum {
    NRF24L01_00_CONFIG_MASK_RX_DR = 6,
    NRF24L01_00_CONFIG_MASK_TX_DS = 5,
    NRF24L01_00_CONFIG_MASK_MAX_RT = 4,
    NRF24L01_00_CONFIG_EN_CRC = 3,
    NRF24L01_00_CONFIG_CRCO = 2,
    NRF24L01_00_CONFIG_PWR_UP = 1,
    NRF24L01_00_CONFIG_PRIM_RX = 0,

    NRF24L01_01_EN_AA_ENAA_P5 = 5,
    NRF24L01_01_EN_AA_ENAA_P4 = 4,
    NRF24L01_01_EN_AA_ENAA_P3 = 3,
    NRF24L01_01_EN_AA_ENAA_P2 = 2,
    NRF24L01_01_EN_AA_ENAA_P1 = 1,
    NRF24L01_01_EN_AA_ENAA_P0 = 0,

    NRF24L01_02_EN_RXADDR_ERX_P5 = 5,
    NRF24L01_02_EN_RXADDR_ERX_P4 = 4,
    NRF24L01_02_EN_RXADDR_ERX_P3 = 3,
    NRF24L01_02_EN_RXADDR_ERX_P2 = 2,
    NRF24L01_02_EN_RXADDR_ERX_P1 = 1,
    NRF24L01_02_EN_RXADDR_ERX_P0 = 0,

    NRF24L01_06_RF_SETUP_RF_DR_LOW = 5,
    NRF24L01_06_RF_SETUP_RF_DR_HIGH = 3,
    NRF24L01_06_RF_SETUP_RF_PWR_HIGH = 2,
    NRF24L01_06_RF_SETUP_RF_PWR_LOW = 1,

    NRF24L01_07_STATUS_RX_DR = 6,
    NRF24L01_07_STATUS_TX_DS = 5,
    NRF24L01_07_STATUS_MAX_RT = 4,

    NRF24L01_17_FIFO_STATUS_TX_FULL = 5,
    NRF24L01_17_FIFO_STATUS_TX_EMPTY = 4,
    NRF24L01_17_FIFO_STATUS_RX_FULL = 1,
    NRF24L01_17_FIFO_STATUS_RX_EMPTY = 0,

    NRF24L01_1C_DYNPD_DPL_P5 = 5,
    NRF24L01_1C_DYNPD_DPL_P4 = 4,
    NRF24L01_1C_DYNPD_DPL_P3 = 3,
    NRF24L01_1C_DYNPD_DPL_P2 = 2,
    NRF24L01_1C_DYNPD_DPL_P1 = 1,
    NRF24L01_1C_DYNPD_DPL_P0 = 0,

    NRF24L01_1D_FEATURE_EN_DPL = 2,
    NRF24L01_1D_FEATURE_EN_ACK_PAY = 1,
    NRF24L01_1D_FEATURE_EN_DYN_ACK = 0
};


enum {
    NRF24L01_01_EN_AA_ALL_PIPES = 0x3F,

    NRF24L01_02_EN_RXADDR_ERX_ALL_PIPES = 0x3F,

    NRF24L01_03_SETUP_AW_3BYTES = 0x01,
    NRF24L01_03_SETUP_AW_4BYTES = 0x02,
    NRF24L01_03_SETUP_AW_5BYTES = 0x03,

    NRF24L01_04_SETUP_RETR_ARD_250us = 0x00,
    NRF24L01_04_SETUP_RETR_ARD_500us = 0x10,
    NRF24L01_04_SETUP_RETR_ARD_750us = 0x20,
    NRF24L01_04_SETUP_RETR_ARD_1000us = 0x30,
    NRF24L01_04_SETUP_RETR_ARD_1250us = 0x40,
    NRF24L01_04_SETUP_RETR_ARD_1500us = 0x50,
    NRF24L01_04_SETUP_RETR_ARD_1750us = 0x60,
    NRF24L01_04_SETUP_RETR_ARD_2000us = 0x70,
    NRF24L01_04_SETUP_RETR_ARD_2250us = 0x80,
    NRF24L01_04_SETUP_RETR_ARD_2500us = 0x90,
    NRF24L01_04_SETUP_RETR_ARD_2750us = 0xa0,
    NRF24L01_04_SETUP_RETR_ARD_3000us = 0xb0,
    NRF24L01_04_SETUP_RETR_ARD_3250us = 0xc0,
    NRF24L01_04_SETUP_RETR_ARD_3500us = 0xd0,
    NRF24L01_04_SETUP_RETR_ARD_3750us = 0xe0,
    NRF24L01_04_SETUP_RETR_ARD_4000us = 0xf0,

    NRF24L01_04_SETUP_RETR_ARC_0 = 0x00,
    NRF24L01_04_SETUP_RETR_ARC_1 = 0x01,
    NRF24L01_04_SETUP_RETR_ARC_2 = 0x02,
    NRF24L01_04_SETUP_RETR_ARC_3 = 0x03,
    NRF24L01_04_SETUP_RETR_ARC_4 = 0x04,
    NRF24L01_04_SETUP_RETR_ARC_5 = 0x05,
    NRF24L01_04_SETUP_RETR_ARC_6 = 0x06,
    NRF24L01_04_SETUP_RETR_ARC_7 = 0x07,
    NRF24L01_04_SETUP_RETR_ARC_8 = 0x08,
    NRF24L01_04_SETUP_RETR_ARC_9 = 0x09,
    NRF24L01_04_SETUP_RETR_ARC_10 = 0x0a,
    NRF24L01_04_SETUP_RETR_ARC_11 = 0x0b,
    NRF24L01_04_SETUP_RETR_ARC_12 = 0x0c,
    NRF24L01_04_SETUP_RETR_ARC_13 = 0x0d,
    NRF24L01_04_SETUP_RETR_ARC_14 = 0x0e,
    NRF24L01_04_SETUP_RETR_ARC_15 = 0x0f,


    NRF24L01_06_RF_SETUP_RF_DR_2Mbps = 0x08,
    NRF24L01_06_RF_SETUP_RF_DR_1Mbps = 0x00,
    NRF24L01_06_RF_SETUP_RF_DR_250Kbps = 0x20,
    NRF24L01_06_RF_SETUP_RF_PWR_n18dbm = 0x01,
    NRF24L01_06_RF_SETUP_RF_PWR_n12dbm = 0x02,
    NRF24L01_06_RF_SETUP_RF_PWR_n6dbm = 0x04,
    NRF24L01_06_RF_SETUP_RF_PWR_0dbm = 0x06,

    NRF24L01_1C_DYNPD_ALL_PIPES = 0x3F
};


enum {
    NRF24L01_PIPE0 = 0,
    NRF24L01_PIPE1 = 1,
    NRF24L01_PIPE2 = 2,
    NRF24L01_PIPE3 = 3,
    NRF24L01_PIPE4 = 4,
    NRF24L01_PIPE5 = 5
};

void NRF24L01_Initialize(uint8_t baseConfig);
uint8_t NRF24L01_WriteReg(uint8_t reg, uint8_t data);
uint8_t NRF24L01_WriteRegisterMulti(uint8_t reg, const uint8_t *data, uint8_t length);
uint8_t NRF24L01_WritePayload(const uint8_t *data, uint8_t length);
uint8_t NRF24L01_WriteAckPayload(const uint8_t *data, uint8_t length, uint8_t pipe);
uint8_t NRF24L01_ReadReg(uint8_t reg);
uint8_t NRF24L01_ReadRegisterMulti(uint8_t reg, uint8_t *data, uint8_t length);
uint8_t NRF24L01_ReadPayload(uint8_t *data, uint8_t length);




void NRF24L01_FlushTx(void);
void NRF24L01_FlushRx(void);
uint8_t NRF24L01_Activate(uint8_t code);

void NRF24L01_SetupBasic(void);
void NRF24L01_SetStandbyMode(void);
void NRF24L01_SetRxMode(void);
void NRF24L01_SetTxMode(void);
void NRF24L01_ClearAllInterrupts(void);
void NRF24L01_SetChannel(uint8_t channel);

# 200 "./src/main/drivers/rx_nrf24l01.h" 3 4
_Bool 
# 200 "./src/main/drivers/rx_nrf24l01.h"
    NRF24L01_ReadPayloadIfAvailable(uint8_t *data, uint8_t length);
# 26 "./src/main/drivers/rx_xn297.c" 2
# 1 "./src/main/common/crc.h" 1
# 18 "./src/main/common/crc.h"
       

struct sbuf_s;

uint16_t crc16_ccitt(uint16_t crc, unsigned char a);
uint16_t crc16_ccitt_update(uint16_t crc, const void *data, uint32_t length);
uint8_t crc8_dvb_s2(uint8_t crc, unsigned char a);
uint8_t crc8_dvb_s2_update(uint8_t crc, const void *data, uint32_t length);
void crc8_dvb_s2_sbuf_append(struct sbuf_s *dst, uint8_t *start);
uint8_t crc8_xor_update(uint8_t crc, const void *data, uint32_t length);
void crc8_xor_sbuf_append(struct sbuf_s *dst, uint8_t *start);
# 27 "./src/main/drivers/rx_xn297.c" 2


static const uint8_t xn297_data_scramble[30] = {
    0xbc, 0xe5, 0x66, 0x0d, 0xae, 0x8c, 0x88, 0x12,
    0x69, 0xee, 0x1f, 0xc7, 0x62, 0x97, 0xd5, 0x0b,
    0x79, 0xca, 0xcc, 0x1b, 0x5d, 0x19, 0x10, 0x24,
    0xd3, 0xdc, 0x3f, 0x8e, 0xc5, 0x2f
};

static const uint16_t xn297_crc_xorout[26] = {
    0x9BA7, 0x8BBB, 0x85E1, 0x3E8C, 0x451E, 0x18E6, 0x6B24, 0xE7AB,
    0x3828, 0x814B, 0xD461, 0xF494, 0x2503, 0x691D, 0xFE8B, 0x9BA7,
    0x8B17, 0x2920, 0x8B5F, 0x61B1, 0xD391, 0x7401, 0x2138, 0x129F,
    0xB3A0, 0x2988
};

static uint8_t bitReverse(uint8_t bIn)
{
    uint8_t bOut = 0;
    for (int ii = 0; ii < 8; ++ii) {
        bOut = (bOut << 1) | (bIn & 1);
        bIn >>= 1;
    }
    return bOut;
}




uint16_t XN297_UnscramblePayload(uint8_t *data, int len, const uint8_t *rxAddr)
{
    uint16_t crc = 0xb5d2;
    if (rxAddr) {
        for (int ii = 0; ii < 5; ++ii) {
            crc = crc16_ccitt(crc, rxAddr[5 - 1 - ii]);
        }
    }
    for (int ii = 0; ii < len; ++ii) {
        crc = crc16_ccitt(crc, data[ii]);
        data[ii] = bitReverse(data[ii] ^ xn297_data_scramble[ii]);
    }
    crc ^= xn297_crc_xorout[len];
    return crc;
}

uint8_t XN297_WritePayload(uint8_t *data, int len, const uint8_t *rxAddr)
{
    uint8_t packet[32];
    uint16_t crc = 0xb5d2;
    for (int ii = 0; ii < 5; ++ii) {
        packet[ii] = rxAddr[5 - 1 - ii];
        crc = crc16_ccitt(crc, packet[ii]);
    }
    for (int ii = 0; ii < len; ++ii) {
        const uint8_t bOut = bitReverse(data[ii]);
        packet[ii + 5] = bOut ^ xn297_data_scramble[ii];
        crc = crc16_ccitt(crc, packet[ii + 5]);
    }
    crc ^= xn297_crc_xorout[len];
    packet[5 + len] = crc >> 8;
    packet[5 + len + 1] = crc & 0xff;
    return NRF24L01_WritePayload(packet, 5 + len + 2);
}
